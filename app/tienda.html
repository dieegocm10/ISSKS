<html>
	<head>
		<title>Denda</title>
	</head>
	
	<body>
		<div align="center" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">
		<form  method="post" action="erabiltzaileBerriaGorde.php" onsubmit="return validarFormulario()"><table>
			<tr>
				<td><label for="izenAbizenak">IZEN ABIZENAK:</label></td>
				<td><input type="text" name="izenAbizenak" id="izenAbizenak"></td>
			</tr>
			<tr>
				<td>NAN:</td>
				<td><input type="text" name="nan"></td>
			</tr>
			<tr>
				<td>TELEFONOA:</td>
				<td><input type="number" name="telefonoa"></td>
			</tr>
			<tr>
				<td>JAIOTZE DATA:</td>
				<td><input type="date" name="jaiotze data"></td>
			</tr>
			<tr>
				<td>EMAIL:</td>
				<td><input type="text" name="email"></td>
			</tr>
			<tr>
				<td>GAKOA:</td>
				<td><input type="text" name="gakoa"></td>
			</tr>
			<tr>
				<td><p align="right"><input type="submit" id="gorde"name="gorde" value="Gorde"></p></td>
				<td><p align="left"><input type="button" id="garbitu"name="garbitu" value="Garbitu"></p></td>
			</tr>
		</table></div>
		
		<script>
			document.addEventListener("DOMContentLoaded", function() {
				var gordeBtn = document.getElementById("gorde");
				var garbiBtn = document.getElementById("garbitu");
				//BOTOI GORDE
				//gordeBtn.addEventListener("click", function() {
				function validarFormulario(){
					var izenAbizenak = document.getElementsByName("izenAbizenak")[0].value;
					var nan = document.getElementsByName("nan")[0].value;
					var telefonoa = document.getElementsByName("telefonoa")[0].value;
					var jaiotzeData = document.getElementsByName("jaiotze data")[0].value;
					var email = document.getElementsByName("email")[0].value;
					var gakoa = document.getElementsByName("gakoa")[0].value;

					if (izenAbizenak == "") {
						alert("IZEN ABIZENAK ez dira jarri");
				  		return false;
					}
					else{
						var regex = /^[a-zA-Z\s]*$/;
						if(!regex.test(izenAbizenak)){
							 alert("Izen Abizenetan bakarrik letrak jarri ahal dira");
							 return false;
						}
					}
					if (nan == "") {
						alert("NAN ez da jarri");
				  		return false;
					}
					else{
						if (nan.length !== 9) {
						    	alert("NAN txarto jarri da");
						    	return false;
						}
						else{
							var zenbakiak = parseInt(nan.substring(0, 8));
						 	var letra = nan.charAt(8);
						 	var hondarra = parseInt(zenbakiak) % 23;
						 	var letrak = "TRWAGMYFPDXBNJZSQVHLCKE";
						 	var kalkulatutakoLetra = letrak.charAt(hondarra);
						 	if (kalkulatutakoLetra != letra) {
						 		alert("NAN txarto jarri da");
						 		return false;
						 	}	 
  						}
					}
					if (telefonoa == "") {
						alert("TELEFONOA ez da jarri");
				  		return false;
					}
					else{
						if(document.getElementsByName("telefonoa")[0].value.length != 9){
							alert("TELEFONOAK 9 zenbaki izan behar ditu");
							return false;
						}
					}
					if (jaiotzeData == "") {
						alert("JAIOTZE DATA ez da jarri");
				  		return false;
					}
					if (email == "") {
						alert("EMAIL ez da jarri");
				  		return false;
					}
					else{
						var regex = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/;
						if(!regex.test(email)){
							alert("EMAIL txarto jarri da");
							return false;
						}
					}
					if (gakoa == "") {
						alert("GAKOA ez da jarri");
				  		return false;
					}
//igual  sobra, si se hace con el submit en vez de button pasa a la siguiente aunque esten mal
					var datuak = {
					  	izenAbizenak: izenAbizenak,
					  	nan: nan,
					  	telefonoa: telefonoa,
					  	email: email,
					  	jaiotzeData: jaiotzeData,
					  	gakoa: gakoa
					};
					var conf = {
					  	method: 'POST',
					  	body: JSON.stringify(datuak), 
					  	headers: {
					    		'Content-Type': 'application/json'
					  	}
					};

					fetch('erabiltzaileBerriaGorde.php', conf)
					  	.then(response => {
						    	if (!response.ok) {
						      		alert("ERROR");
						    	}
						    	else{
						    		alert("OK");
						    	}
						})
					  	.catch(error => {
					    		alert(error);
					  	});
				});//hasta aqui
				//BOTOI GARBITU
				garbiBtn.addEventListener("click", function() {
					document.getElementsByName("izena")[0].value = "";
					document.getElementsByName("abizena")[0].value = "";
					document.getElementsByName("telefonoa")[0].value = "";
					document.getElementsByName("jaiotze data")[0].value = "";
					document.getElementsByName("email")[0].value = "";
					document.getElementsByName("gakoa")[0].value = "";
				});
			});
</script>

	</body>
</html>
