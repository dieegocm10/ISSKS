<html>
	<head>
		<title>Denda</title>
	</head>
	
	<body>
		<div align="center" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">
		<form  method="post" onsubmit="return erabiltzaileaAldatu()"><table>
			<tr>
				<td>IZEN ABIZENAK:</td>	<!-Zure izen-abizen sartzeko tokia!>
				<td><input type="text" name="izenAbizenak" id="izenAbizenak"></td>
			</tr>
			<tr>
				<td>NAN:</td>	<!-Zure NAN sartzeko tokia!>
				<td><input type="text" name="nan" placeholder="11111111Z" ></td>
			</tr>
			<tr>
				<td>TELEFONOA:</td>	<!-Zure telefonoa sartzeko tokia!>
				<td><input type="number" name="telefonoa" placeholder="666666666" ></td>
			</tr>
			<tr>
				<td>JAIOTZE DATA:</td>	<!-Zure jaiotze data sartzeko tokia!>
				<td><input type="date" name="jaiotze data" placeholder="ee/hh/uuuu" ></td>
			</tr>
			<tr>
				<td>EMAIL:</td>	<!-Zure email sartzeko tokia!>
				<td><input type="text" name="email" placeholder="adibidea@zerbitzaria.extentsioa" ></td>
			</tr>
			<tr>
				<td>GAKOA:</td>	<!-Zure gako sartzeko tokia!>
				<td><input type="text" name="gakoa"></td>
			</tr>
			<tr>
				<td><p align="right"><input type="submit" formaction="erabiltzaileaAldatu.php" id="gorde"name="gorde" value="Gorde"></p></td>	<!-Gorde botoai programatu!>
				<td><p align="left"><input type="submit" formaction="erabiltzaileaEzabatu.php" id="garbitu"name="ezabatu" value="Erabiltzailea ezabatu"></p></td>	<!-Ezabatu botoia programatu>
			</tr>
		</table></div>
		
		<script>
			document.addEventListener("DOMContentLoaded", function() {
				var gordeBtn = document.getElementById("gorde");	//Gorde botoia aldagai batean gorde
				var ezabatuBtn = document.getElementById("ezabatu");	//Ezabatu botoia aldagai batean gorde
				
				var izenAbizenak = document.getElementsByName("izenAbizenak")[0].value;	//Erabiltzailearen atributuak aldagaietan gorde
				var nan = document.getElementsByName("nan")[0].value;
				var telefonoa = document.getElementsByName("telefonoa")[0].value;
				var jaiotzeData = document.getElementsByName("jaiotze data")[0].value;
				var email = document.getElementsByName("email")[0].value;
				var gakoa = document.getElementsByName("gakoa")[0].value;
				
				//BOTOI GORDE
				gordeBtn.addEventListener("click", function() {
					if(datuakKonprobatu()){
					    erabiltzaileaAldatu()
					}
					else{
					    return false;
					}
				});
				//BOTOI EZABATU
				garbiBtn.addEventListener("click", function() {
					if(datuakKonprobatu()){
					    erabiltzaileaEzabatu()
					}
					else{
					    return false;
					}
				});
			});
			
			function datuakKonprobatu(){
				if (izenAbizenak == "") {
					alert("IZEN ABIZENAK ez dira jarri");
				  	return false;
				}
				else{
					var regex = /^[a-zA-Z\s]*$/;
					if(!regex.test(izenAbizenak)){
						 alert("Izen Abizenetan bakarrik letrak jarri ahal dira");
						 return false;
					}
				}
				if (nan == "") {
					alert("NAN ez da jarri");
				  	return false;
				}
				else{
					if (nan.length !== 9) {
						alert("NAN txarto jarri da");
						return false;
					}
					else{
						var zenbakiak = parseInt(nan.substring(0, 8));
						 var letra = nan.charAt(8);
						 var hondarra = parseInt(zenbakiak) % 23;
						 var letrak = "TRWAGMYFPDXBNJZSQVHLCKE";
						 var kalkulatutakoLetra = letrak.charAt(hondarra);
						 if (kalkulatutakoLetra != letra) {
						 	alert("NAN txarto jarri da");
						 	return false;
						 }	 
  					}
				}
				if (telefonoa == "") {
					alert("TELEFONOA ez da jarri");
				  	return false;
				}
				else{
					if(document.getElementsByName("telefonoa")[0].value.length != 9){
						alert("TELEFONOAK 9 zenbaki izan behar ditu");
						return false;
					}
				}
				if (jaiotzeData == "") {
					alert("JAIOTZE DATA ez da jarri");
				  	return false;
				}
				if (email == "") {
					alert("EMAIL ez da jarri");
				  	return false;
				}
				else{
					var regex = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/;
					if(!regex.test(email)){
						alert("EMAIL txarto jarri da");
						return false;
					}
				}
				if (gakoa == "") {
					alert("GAKOA ez da jarri");
				  	return false;
				}
			}
			function erabiltzaileaAldatu(){
				//DATUAK BIDALI
				var datuak = {
					  izenAbizenak: izenAbizenak,
					  nan: nan,
					  telefonoa: telefonoa,
					  email: email,
					  jaiotzeData: jaiotzeData,
					  gakoa: gakoa
				};
				var conf = {
					  method: 'POST',
					  body: JSON.stringify(datuak), 
					  headers: {
					    	'Content-Type': 'application/json'
					  }
				};

				fetch('erabiltzaileaAldatu.php', conf)
			}
			
			function erabiltzaileaEzabatu(){
				//DATUAK BIDALI
				var datuak = {
					  izenAbizenak: izenAbizenak,
					  nan: nan,
					  telefonoa: telefonoa,
					  email: email,
					  jaiotzeData: jaiotzeData,
					  gakoa: gakoa
				};
				var conf = {
					  method: 'POST',
					  body: JSON.stringify(datuak), 
					  headers: {
					    	'Content-Type': 'application/json'
					  }
				};

				fetch('erabiltzaileaEzabatu.php', conf)
			}
		</script>
	</body>
</hyml>
